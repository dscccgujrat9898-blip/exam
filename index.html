<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SSC CBT Mock (Auto-load Bank)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root{--bg:#0b1220;--card:#111d3b;--txt:#eaf1ff;--mut:#aab7d2;--pri:#2b5cff;--ok:#22c55e;--bad:#ef4444;--warn:#f59e0b;}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{margin:0;background:var(--bg);color:var(--txt);}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);position:sticky;top:0;background:rgba(11,18,32,.92);backdrop-filter:blur(10px);z-index:10;}
    .brand{font-weight:800}
    .timer{font-variant-numeric:tabular-nums;font-weight:800}
    .wrap{display:grid;grid-template-columns: 1fr 320px;gap:14px;padding:14px;max-width:1200px;margin:0 auto;}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px;box-shadow:0 10px 40px rgba(0,0,0,.25);}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    label{font-size:12px;color:var(--mut);display:block;margin:6px 0 6px}
    select,input{width:100%;padding:10px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0f1b34;color:var(--txt)}
    button{border:0;border-radius:12px;padding:10px 12px;background:var(--pri);color:white;font-weight:800;cursor:pointer}
    button.sec{background:transparent;border:1px solid rgba(255,255,255,.16)}
    button.dng{background:var(--bad)}
    .qmeta{display:flex;gap:10px;flex-wrap:wrap;color:var(--mut);font-size:12px}
    .qtext{font-size:16px;line-height:1.4;margin:10px 0 12px}
    .opt{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid rgba(255,255,255,.10);border-radius:12px;margin:8px 0;cursor:pointer}
    .opt input{width:auto;margin-top:3px}
    .opt.sel{border-color:rgba(43,92,255,.7);background:rgba(43,92,255,.12)}
    .palette{display:grid;grid-template-columns: repeat(6, 1fr);gap:8px}
    .pbtn{padding:8px 0;text-align:center;border-radius:10px;font-weight:800;cursor:pointer;border:1px solid rgba(255,255,255,.10);background:#0f1b34}
    .pbtn.ans{outline:2px solid rgba(34,197,94,.55)}
    .pbtn.rev{outline:2px solid rgba(245,158,11,.55)}
    .pbtn.cur{background:rgba(43,92,255,.25);border-color:rgba(43,92,255,.6)}
    .small{font-size:12px;color:var(--mut)}
    .hide{display:none}
    .stat{display:flex;justify-content:space-between;padding:10px;border:1px solid rgba(255,255,255,.10);border-radius:12px;margin:8px 0;background:rgba(0,0,0,.12)}
    code{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:8px}
  </style>
</head>
<body>
<header>
  <div class="brand">SSC CBT Mock (Auto-load Bank)</div>
  <div class="timer" id="timer">00:00:00</div>
</header>

<div class="wrap">
  <div class="card">
    <div id="setup">
      <div class="small">
        ‚úÖ ‡§Ø‡§π version bank ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ load ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‚Äî ‡§ï‡•ã‡§à upload button ‡§®‡§π‡•Ä‡§Ç‡•§<br/>
        üìå ‡§¨‡§∏ ‡§â‡§∏‡•Ä folder/repo ‡§Æ‡•á‡§Ç Excel file ‡§∞‡§ñ‡•á‡§Ç: <code>bank/SSC_QuestionBank.xlsx</code>
      </div>

      <div style="height:10px"></div>

      <div class="row">
        <div style="flex:1;min-width:220px">
          <label>Exam</label>
          <select id="exam"><option value="">All</option><option>CHSL</option><option>MTS</option><option>STENO</option><option>CGL</option><option>CPO</option><option>GD</option></select>
        </div>
        <div style="flex:1;min-width:220px">
          <label>Level</label>
          <select id="level"><option value="">All</option><option value="12th">12th</option><option value="Grad">Grad</option></select>
        </div>
        <div style="flex:1;min-width:220px">
          <label>Subject</label>
          <select id="subject"><option value="">All</option><option>English</option><option>Reasoning</option><option>Quant</option><option>GK</option></select>
        </div>
        <div style="flex:1;min-width:220px">
          <label>Language</label>
          <select id="lang">
            <option value="">All</option>
            <option value="HI">Hindi</option>
            <option value="EN">English</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div style="flex:1;min-width:220px">
          <label>Questions</label>
          <input id="count" type="number" value="25" min="5" max="200"/>
        </div>
        <div style="flex:1;min-width:220px">
          <label>Time (minutes)</label>
          <input id="minutes" type="number" value="20" min="1" max="240"/>
        </div>
        <div style="flex:1;min-width:220px">
          <label>Anti-Repeat (same device)</label>
          <select id="antiRepeat"><option value="1">ON</option><option value="0">OFF</option></select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="startBtn">Start Test</button>
        <button class="sec" id="resetBtn">Reset Anti-Repeat</button>
      </div>
      <div class="small" id="status" style="margin-top:10px"></div>
    </div>

    <div id="examUI" class="hide">
      <div class="qmeta" id="qmeta"></div>
      <div class="qtext" id="qtext"></div>
      <div id="opts"></div>
      <div class="row" style="margin-top:10px">
        <button class="sec" id="prevBtn">Prev</button>
        <button class="sec" id="markBtn">Mark</button>
        <button class="sec" id="clearBtn">Clear</button>
        <button id="nextBtn">Next</button>
        <button class="dng" id="submitBtn">Submit</button>
      </div>
    </div>

    <div id="resultUI" class="hide">
      <h2 style="margin:0 0 8px">Result</h2>
      <div class="stat"><div>Total</div><div id="rTotal"></div></div>
      <div class="stat"><div>Correct</div><div id="rCorrect"></div></div>
      <div class="stat"><div>Wrong</div><div id="rWrong"></div></div>
      <div class="stat"><div>Unattempted</div><div id="rUnatt"></div></div>
      <div class="stat"><div>Score</div><div id="rScore"></div></div>
      <div class="stat"><div>Accuracy</div><div id="rAcc"></div></div>
      <div class="row" style="margin-top:10px">
        <button id="newBtn">New Test</button>
      </div>
      <div class="small" style="margin-top:10px">
        GitHub Pages ‡§™‡§∞: repo ‡§Æ‡•á‡§Ç <code>bank/SSC_QuestionBank.xlsx</code> file ‡§∞‡§ñ‡•á‡§Ç‡•§
      </div>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-weight:800">Palette</div>
      <div class="small" id="progress">0/0</div>
    </div>
    <div style="height:10px"></div>
    <div class="palette" id="palette"></div>
    <div style="height:10px"></div>
    <div class="small">Green outline = Answered<br/>Orange outline = Marked</div>
  </div>
</div>

<script>
  const $ = (id)=>document.getElementById(id);

  // Put the Excel file in your repo at: /bank/SSC_QuestionBank.xlsx
  const BANK_URL = "./bank/SSC_QuestionBank.xlsx";
  // Put this file name exactly in /bank folder.

  const seenKey = "ssc_seen_ids_autoload_v1";
  let bank = [];
  let questions = [];
  let idx = 0;
  let answers = {};
  let review = new Set();
  let endAt = 0;
  let tick = null;

  function getSeenSet(){ try{return new Set(JSON.parse(localStorage.getItem(seenKey)||"[]"));}catch(e){return new Set();} }
  function saveSeenSet(set){ localStorage.setItem(seenKey, JSON.stringify([...set])); }

  function fmtTime(ms){
    ms = Math.max(0, ms);
    const s = Math.floor(ms/1000);
    const hh = String(Math.floor(s/3600)).padStart(2,"0");
    const mm = String(Math.floor((s%3600)/60)).padStart(2,"0");
    const ss = String(s%60).padStart(2,"0");
    return `${hh}:${mm}:${ss}`;
  }
  function startTimer(minutes){
    endAt = Date.now() + minutes*60*1000;
    clearInterval(tick);
    tick = setInterval(()=>{
      const left = endAt - Date.now();
      $("timer").textContent = fmtTime(left);
      if(left<=0){ clearInterval(tick); submit(); }
    }, 250);
  }

  function show(id){ $(id).classList.remove("hide"); }
  function hide(id){ $(id).classList.add("hide"); }

  function renderPalette(){
    const pal = $("palette");
    pal.innerHTML = "";
    questions.forEach((q,i)=>{
      const b = document.createElement("div");
      b.className = "pbtn";
      b.textContent = i+1;
      if(i===idx) b.classList.add("cur");
      if(answers[q.id]) b.classList.add("ans");
      if(review.has(q.id)) b.classList.add("rev");
      b.onclick = ()=>{ idx=i; renderQ(); };
      pal.appendChild(b);
    });
    $("progress").textContent = `${Object.keys(answers).length}/${questions.length}`;
  }

  function renderQ(){
    const q = questions[idx];
    $("qmeta").innerHTML = `
      <span><b>Q ${idx+1}</b> / ${questions.length}</span>
      <span>${q.exam} | ${q.level} | ${q.subject}</span>
      <span>Topic: ${q.topic}</span>
      <span>Marks: ${q.marks}</span>
      <span>Neg: ${q.neg}</span>
    `;
    $("qtext").textContent = q.question;
    const sel = answers[q.id] || "";
    const opts = [["A",q.optA],["B",q.optB],["C",q.optC],["D",q.optD]];
    const wrap = $("opts");
    wrap.innerHTML = "";
    opts.forEach(([k,v])=>{
      const div = document.createElement("div");
      div.className = "opt" + (sel===k ? " sel":"");
      div.innerHTML = `<input type="radio" name="opt" ${sel===k?"checked":""}/>
                       <div><b>${k}.</b> ${v}</div>`;
      div.onclick = ()=>{
        answers[q.id] = k;
        renderQ(); renderPalette();
      };
      wrap.appendChild(div);
    });
    renderPalette();
  }

  function submit(){
    clearInterval(tick);
    if($("antiRepeat").value==="1"){
      const seen = getSeenSet();
      questions.forEach(q=>seen.add(q.id));
      saveSeenSet(seen);
    }
    let correct=0, wrong=0, unatt=0, score=0;
    questions.forEach(q=>{
      const a = answers[q.id];
      if(!a){unatt++; return;}
      if(a===q.answer){correct++; score += Number(q.marks||1);}
      else{wrong++; score -= Number(q.neg||0.25);}
    });
    const attempted = questions.length - unatt;
    const acc = attempted ? (correct/attempted*100) : 0;
    hide("examUI"); show("resultUI");
    $("rTotal").textContent = questions.length;
    $("rCorrect").textContent = correct;
    $("rWrong").textContent = wrong;
    $("rUnatt").textContent = unatt;
    $("rScore").textContent = score.toFixed(2);
    $("rAcc").textContent = acc.toFixed(2) + "%";
  }

  $("prevBtn").onclick = ()=>{ if(idx>0){idx--; renderQ();} };
  $("nextBtn").onclick = ()=>{ if(idx<questions.length-1){idx++; renderQ();} };
  $("markBtn").onclick = ()=>{ const q=questions[idx]; review.has(q.id)?review.delete(q.id):review.add(q.id); renderPalette(); };
  $("clearBtn").onclick = ()=>{ const q=questions[idx]; delete answers[q.id]; renderQ(); renderPalette(); };
  $("submitBtn").onclick = submit;
  $("newBtn").onclick = ()=>location.reload();
  $("resetBtn").onclick = ()=>{ localStorage.removeItem(seenKey); $("status").textContent="Anti-Repeat reset ‚úÖ"; };

  async function loadBank(){
    $("status").textContent = "Loading bank from: " + BANK_URL;
    const res = await fetch(BANK_URL, {cache:"no-store"});
    if(!res.ok) throw new Error("Bank file not found. BANK_URL check ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ file repo ‡§Æ‡•á‡§Ç ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§");
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, {type:"array"});
    const ws = wb.Sheets["QUESTIONS"];
    if(!ws) throw new Error("XLSX ‡§Æ‡•á‡§Ç sheet 'QUESTIONS' ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§");
    bank = XLSX.utils.sheet_to_json(ws, {defval:""});
    $("status").textContent = "Bank loaded ‚úÖ Rows: " + bank.length;
  }

  function pickQuestions(){
    const exam = $("exam").value;
    const level = $("level").value;
    const subject = $("subject").value;
    const lang = $("lang").value;
    const count = Math.max(5, Math.min(parseInt($("count").value||"25",10), 200));
    let pool = bank.filter(r=>{
      if(exam && r.exam!==exam) return false;
      if(level && r.level!==level) return false;
      if(subject && r.subject!==subject) return false;
      if(lang && String(r.lang||"").trim()!==lang) return false;
      return true;
    });

    if($("antiRepeat").value==="1"){
      const seen = getSeenSet();
      pool = pool.filter(r=>!seen.has(r.id));
    }

    for(let i=pool.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [pool[i],pool[j]]=[pool[j],pool[i]];
    }
    return pool.slice(0,count);
  }

  $("startBtn").onclick = async ()=>{
    try{
      if(!bank.length) await loadBank();
      questions = pickQuestions();
      if(!questions.length) throw new Error("No questions matched / bank ‡§ñ‡§§‡•ç‡§Æ ‡§π‡•ã ‡§ó‡§Ø‡§æ (Anti-Repeat ON).");

      idx=0; answers={}; review=new Set();
      hide("setup"); hide("resultUI"); show("examUI");
      startTimer(parseInt($("minutes").value||"20",10));
      renderQ();
    }catch(err){
      $("status").textContent = "Error: " + err.message;
    }
  };
</script>
</body>
</html>
